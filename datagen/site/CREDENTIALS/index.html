
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://amattas.github.io/retail-demo/CREDENTIALS/">
      
      
        <link rel="prev" href="../STREAMING_OPERATIONS/">
      
      
        <link rel="next" href="../VALIDATION/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Credentials - Retail Datagen</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#credential-management-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Retail Datagen" class="md-header__button md-logo" aria-label="Retail Datagen" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Retail Datagen
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Credentials
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Retail Datagen" class="md-nav__button md-logo" aria-label="Retail Datagen" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Retail Datagen
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../LOCAL_DATA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Local Data
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../UPLOAD_DATA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Upload Data
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../STREAMING_SETUP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Streaming Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../FACT_GENERATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fact Generation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../STORE_PROFILES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Store Profiles
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Streaming
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Streaming
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../STREAMING_API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../STREAMING_OPERATIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Credentials
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Credentials
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of Contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-principles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Principles
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Principles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#never-commit-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      
        Never Commit Credentials
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#principle-of-least-privilege" class="md-nav__link">
    <span class="md-ellipsis">
      
        Principle of Least Privilege
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defense-in-depth" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defense in Depth
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#credential-storage-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Credential Storage Methods
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Credential Storage Methods">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#method-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      
        Method Comparison
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Environment Variables
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setting Environment Variables
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setting Environment Variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#linuxmacos-bashzsh" class="md-nav__link">
    <span class="md-ellipsis">
      
        Linux/macOS (Bash/Zsh)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azure-storage-for-uploads-optional" class="md-nav__link">
    <span class="md-ellipsis">
      
        Azure Storage for Uploads (Optional)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Azure Storage for Uploads (Optional)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      
        Windows (PowerShell)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    <span class="md-ellipsis">
      
        Docker
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kubernetes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices-for-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices for Environment Variables
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azure-key-vault" class="md-nav__link">
    <span class="md-ellipsis">
      
        Azure Key Vault
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Azure Key Vault">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-create-key-vault" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Create Key Vault
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-store-connection-string" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Store Connection String
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-grant-access" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Grant Access
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Application Integration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Application Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install Dependencies
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-code" class="md-nav__link">
    <span class="md-ellipsis">
      
        Python Code
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices-for-key-vault" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices for Key Vault
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration Files
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuration Files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-development-only" class="md-nav__link">
    <span class="md-ellipsis">
      
        Local Development Only
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#template-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Template Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encryption-at-rest" class="md-nav__link">
    <span class="md-ellipsis">
      
        Encryption at Rest
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Permissions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cicd-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        CI/CD Integration
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CI/CD Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#github-actions" class="md-nav__link">
    <span class="md-ellipsis">
      
        GitHub Actions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azure-devops" class="md-nav__link">
    <span class="md-ellipsis">
      
        Azure DevOps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gitlab-cicd" class="md-nav__link">
    <span class="md-ellipsis">
      
        GitLab CI/CD
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rotation-revocation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rotation &amp; Revocation
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rotation &amp; Revocation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#regular-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Regular Rotation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rotation-process" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rotation Process
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rotation Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-generate-new-key" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Generate New Key
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-update-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Update Credentials
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-restart-applications" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Restart Applications
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-verify" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Verify
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emergency-revocation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Emergency Revocation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#audit-compliance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Audit &amp; Compliance
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Audit &amp; Compliance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-audit-logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enable Audit Logging
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#query-audit-logs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Query Audit Logs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compliance-reports" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compliance Reports
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compliance-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Compliance Checklist
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-incident-response" class="md-nav__link">
    <span class="md-ellipsis">
      
        Security Incident Response
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Incident Response">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#if-credentials-are-leaked" class="md-nav__link">
    <span class="md-ellipsis">
      
        If Credentials Are Leaked
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prevention-checklist" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prevention Checklist
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resources
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next Steps
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../VALIDATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Validation
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sql/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="credential-management-guide">Credential Management Guide<a class="headerlink" href="#credential-management-guide" title="Permanent link">&para;</a></h1>
<p>Comprehensive guide for securely managing Azure Event Hub credentials and sensitive configuration.</p>
<h2 id="table-of-contents">Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#security-principles">Security Principles</a></li>
<li><a href="#credential-storage-methods">Credential Storage Methods</a></li>
<li><a href="#environment-variables">Environment Variables</a></li>
<li><a href="#azure-key-vault">Azure Key Vault</a></li>
<li><a href="#configuration-files">Configuration Files</a></li>
<li><a href="#cicd-integration">CI/CD Integration</a></li>
<li><a href="#rotation--revocation">Rotation &amp; Revocation</a></li>
<li><a href="#audit--compliance">Audit &amp; Compliance</a></li>
</ul>
<hr />
<h2 id="security-principles">Security Principles<a class="headerlink" href="#security-principles" title="Permanent link">&para;</a></h2>
<h3 id="never-commit-credentials">Never Commit Credentials<a class="headerlink" href="#never-commit-credentials" title="Permanent link">&para;</a></h3>
<p><strong>Critical Rule</strong>: Never commit credentials to version control.</p>
<p><strong>Why?</strong>
- Credentials in git history remain accessible even after deletion
- Public repositories expose credentials to the world
- Automated bots scan GitHub for credentials within minutes
- Compliance violations (SOC 2, ISO 27001, PCI DSS)</p>
<p><strong>Prevention:</strong></p>
<ol>
<li>
<p><strong>Add to .gitignore:</strong>
   <code>bash
   echo 'config.json' &gt;&gt; .gitignore
   echo '.env' &gt;&gt; .gitignore
   echo '*.secret' &gt;&gt; .gitignore</code></p>
</li>
<li>
<p><strong>Use git-secrets:</strong>
   ```bash
   # Install git-secrets
   brew install git-secrets</p>
</li>
</ol>
<p># Configure for repository
   cd /path/to/retail-datagen
   git secrets --install
   git secrets --register-aws
   ```</p>
<ol>
<li><strong>Pre-commit hooks:</strong>
   <code>bash
   # .git/hooks/pre-commit
   #!/bin/bash
   if git diff --cached | grep -i "SharedAccessKey"; then
     echo "ERROR: Attempting to commit Azure credentials!"
     exit 1
   fi</code></li>
</ol>
<h3 id="principle-of-least-privilege">Principle of Least Privilege<a class="headerlink" href="#principle-of-least-privilege" title="Permanent link">&para;</a></h3>
<p><strong>Grant minimum necessary permissions:</strong></p>
<ul>
<li><strong>Development</strong>: Send-only permissions</li>
<li><strong>Production</strong>: Send-only with specific Event Hub access</li>
<li><strong>Monitoring</strong>: Listen-only permissions</li>
<li><strong>Management</strong>: Separate credentials for admin operations</li>
</ul>
<p><strong>Azure Event Hub Access Policies:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nv">Development</span><span class="w"> </span><span class="nv">Policy</span><span class="w"> </span><span class="ss">(</span><span class="k">Send</span><span class="w"> </span><span class="nv">Only</span><span class="ss">)</span>:
<span class="o">-</span><span class="w"> </span><span class="nv">Permissions</span>:<span class="w"> </span><span class="k">Send</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Event</span><span class="w"> </span><span class="nv">Hub</span>:<span class="w"> </span><span class="nv">retail</span><span class="o">-</span><span class="nv">events</span><span class="o">-</span><span class="nv">dev</span>

<span class="nv">Production</span><span class="w"> </span><span class="nv">Policy</span><span class="w"> </span><span class="ss">(</span><span class="k">Send</span><span class="w"> </span><span class="nv">Only</span><span class="ss">)</span>:
<span class="o">-</span><span class="w"> </span><span class="nv">Permissions</span>:<span class="w"> </span><span class="k">Send</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Event</span><span class="w"> </span><span class="nv">Hub</span>:<span class="w"> </span><span class="nv">retail</span><span class="o">-</span><span class="nv">events</span><span class="o">-</span><span class="nv">prod</span>

<span class="nv">Monitoring</span><span class="w"> </span><span class="nv">Policy</span><span class="w"> </span><span class="ss">(</span><span class="nv">Listen</span><span class="w"> </span><span class="nv">Only</span><span class="ss">)</span>:
<span class="o">-</span><span class="w"> </span><span class="nv">Permissions</span>:<span class="w"> </span><span class="nv">Listen</span>
<span class="o">-</span><span class="w"> </span><span class="nv">Event</span><span class="w"> </span><span class="nv">Hub</span>:<span class="w"> </span><span class="nv">retail</span><span class="o">-</span><span class="nv">events</span><span class="o">-</span><span class="nv">prod</span>
</code></pre></div>

<h3 id="defense-in-depth">Defense in Depth<a class="headerlink" href="#defense-in-depth" title="Permanent link">&para;</a></h3>
<p><strong>Multiple layers of security:</strong></p>
<ol>
<li><strong>Network</strong>: Firewall rules, private endpoints</li>
<li><strong>Identity</strong>: Azure Active Directory, Managed Identities</li>
<li><strong>Access</strong>: RBAC, access policies</li>
<li><strong>Audit</strong>: Logging, monitoring, alerts</li>
<li><strong>Encryption</strong>: TLS 1.2+, encryption at rest</li>
</ol>
<hr />
<h2 id="credential-storage-methods">Credential Storage Methods<a class="headerlink" href="#credential-storage-methods" title="Permanent link">&para;</a></h2>
<h3 id="method-comparison">Method Comparison<a class="headerlink" href="#method-comparison" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Method</th>
<th>Security</th>
<th>Complexity</th>
<th>Best For</th>
</tr>
</thead>
<tbody>
<tr>
<td>Environment Variables</td>
<td>Medium</td>
<td>Low</td>
<td>Development, CI/CD</td>
</tr>
<tr>
<td>Azure Key Vault</td>
<td>High</td>
<td>Medium</td>
<td>Production, Enterprise</td>
</tr>
<tr>
<td>Configuration Files</td>
<td>Low</td>
<td>Low</td>
<td>Local development only</td>
</tr>
<tr>
<td>Managed Identity</td>
<td>Highest</td>
<td>Medium</td>
<td>Azure deployments</td>
</tr>
<tr>
<td>Azure Storage (Upload)</td>
<td>Medium</td>
<td>Low</td>
<td>Optional upload after export</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="environment-variables">Environment Variables<a class="headerlink" href="#environment-variables" title="Permanent link">&para;</a></h2>
<h3 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h3>
<p>Environment variables are the recommended method for development and CI/CD pipelines.</p>
<p><strong>Advantages:</strong>
- Simple to use
- No files to manage
- Easy to rotate
- Supported by all deployment platforms</p>
<p><strong>Disadvantages:</strong>
- Visible in process listings
- Not encrypted at rest
- Can be leaked via error messages</p>
<h3 id="setting-environment-variables">Setting Environment Variables<a class="headerlink" href="#setting-environment-variables" title="Permanent link">&para;</a></h3>
<h4 id="linuxmacos-bashzsh">Linux/macOS (Bash/Zsh)<a class="headerlink" href="#linuxmacos-bashzsh" title="Permanent link">&para;</a></h4>
<p><strong>Temporary (current session only):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_EVENTHUB_CONNECTION_STRING</span><span class="o">=</span><span class="s2">&quot;Endpoint=sb://your-namespace.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=your-key;EntityPath=retail-events&quot;</span>
</code></pre></div>

<p><strong>Persistent (add to shell profile):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Add to ~/.bashrc, ~/.zshrc, or ~/.profile</span>
<span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export AZURE_EVENTHUB_CONNECTION_STRING=&quot;Endpoint=sb://...&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
<span class="nb">source</span><span class="w"> </span>~/.bashrc
</code></pre></div>

<p><strong>Verify:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nb">echo</span><span class="w"> </span><span class="nv">$AZURE_EVENTHUB_CONNECTION_STRING</span>
</code></pre></div>

<h3 id="azure-storage-for-uploads-optional">Azure Storage for Uploads (Optional)<a class="headerlink" href="#azure-storage-for-uploads-optional" title="Permanent link">&para;</a></h3>
<p>Used by the "Upload Dimensions/Facts" actions after export.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Account URI (optionally include container/prefix)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_STORAGE_ACCOUNT_URI</span><span class="o">=</span><span class="s2">&quot;https://&lt;account&gt;.blob.core.windows.net[/&lt;container&gt;[/&lt;prefix&gt;]]&quot;</span>

<span class="c1"># Account key</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_STORAGE_ACCOUNT_KEY</span><span class="o">=</span><span class="s2">&quot;&lt;storage-account-key&gt;&quot;</span>
</code></pre></div>

<p>You may also set these in <code>config.json</code> under <code>storage</code>.</p>
<h4 id="windows-powershell">Windows (PowerShell)<a class="headerlink" href="#windows-powershell" title="Permanent link">&para;</a></h4>
<p><strong>Temporary (current session only):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nv">$env:AZURE_EVENTHUB_CONNECTION_STRING</span> <span class="p">=</span> <span class="s2">&quot;Endpoint=sb://your-namespace.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=your-key;EntityPath=retail-events&quot;</span>
</code></pre></div>

<p><strong>Persistent (user scope):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="no">[System.Environment]</span><span class="p">::</span><span class="n">SetEnvironmentVariable</span><span class="p">(</span><span class="s1">&#39;AZURE_EVENTHUB_CONNECTION_STRING&#39;</span><span class="p">,</span> <span class="s1">&#39;Endpoint=sb://...&#39;</span><span class="p">,</span> <span class="s1">&#39;User&#39;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Persistent (system scope - requires admin):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="no">[System.Environment]</span><span class="p">::</span><span class="n">SetEnvironmentVariable</span><span class="p">(</span><span class="s1">&#39;AZURE_EVENTHUB_CONNECTION_STRING&#39;</span><span class="p">,</span> <span class="s1">&#39;Endpoint=sb://...&#39;</span><span class="p">,</span> <span class="s1">&#39;Machine&#39;</span><span class="p">)</span>
</code></pre></div>

<p><strong>Verify:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nv">$env:AZURE_EVENTHUB_CONNECTION_STRING</span>
</code></pre></div>

<h4 id="docker">Docker<a class="headerlink" href="#docker" title="Permanent link">&para;</a></h4>
<p><strong>Pass at runtime:</strong></p>
<div class="codehilite"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span>retail-datagen<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span><span class="m">8000</span>:8000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-e<span class="w"> </span><span class="nv">AZURE_EVENTHUB_CONNECTION_STRING</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$AZURE_EVENTHUB_CONNECTION_STRING</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>retail-datagen
</code></pre></div>

<p><strong>Using .env file:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create .env file (don&#39;t commit!)</span>
cat<span class="w"> </span>&gt;<span class="w"> </span>.env<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">AZURE_EVENTHUB_CONNECTION_STRING=Endpoint=sb://...</span>
<span class="s">EOF</span>

<span class="c1"># Run with .env file</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span>retail-datagen<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-p<span class="w"> </span><span class="m">8000</span>:8000<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--env-file<span class="w"> </span>.env<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>retail-datagen
</code></pre></div>

<h4 id="kubernetes">Kubernetes<a class="headerlink" href="#kubernetes" title="Permanent link">&para;</a></h4>
<p><strong>Using Secrets:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create secret from literal</span>
kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>azure-credentials<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--from-literal<span class="o">=</span>connection-string<span class="o">=</span><span class="s2">&quot;Endpoint=sb://...&quot;</span>

<span class="c1"># Create secret from file</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Endpoint=sb://...&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>connection-string.txt
kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>azure-credentials<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--from-file<span class="o">=</span>connection-string<span class="o">=</span>connection-string.txt
rm<span class="w"> </span>connection-string.txt
</code></pre></div>

<p><strong>Deployment manifest:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">retail-datagen</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">retail-datagen</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">retail-datagen:latest</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AZURE_EVENTHUB_CONNECTION_STRING</span>
<span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">            </span><span class="nt">secretKeyRef</span><span class="p">:</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">azure-credentials</span>
<span class="w">              </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">connection-string</span>
</code></pre></div>

<h3 id="best-practices-for-environment-variables">Best Practices for Environment Variables<a class="headerlink" href="#best-practices-for-environment-variables" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Use strong naming conventions:</strong></li>
<li>Prefix with application name: <code>RETAIL_DATAGEN_*</code></li>
<li>
<p>Uppercase with underscores: <code>AZURE_EVENTHUB_CONNECTION_STRING</code></p>
</li>
<li>
<p><strong>Validate presence at startup:</strong>
   ```python
   import os</p>
</li>
</ol>
<p>conn_str = os.getenv('AZURE_EVENTHUB_CONNECTION_STRING')
   if not conn_str:
       raise ValueError("AZURE_EVENTHUB_CONNECTION_STRING not set")
   ```</p>
<ol>
<li><strong>Don't log environment variables:</strong>
   ```python
   # Bad - logs credential
   logger.info(f"Connection string: {conn_str}")</li>
</ol>
<p># Good - masks credential
   logger.info("Connection string: [REDACTED]")
   ```</p>
<ol>
<li><strong>Clear after use (if sensitive):</strong>
   <code>bash
   unset AZURE_EVENTHUB_CONNECTION_STRING</code></li>
</ol>
<hr />
<h2 id="azure-key-vault">Azure Key Vault<a class="headerlink" href="#azure-key-vault" title="Permanent link">&para;</a></h2>
<h3 id="overview_1">Overview<a class="headerlink" href="#overview_1" title="Permanent link">&para;</a></h3>
<p>Azure Key Vault is the recommended solution for production environments.</p>
<p><strong>Advantages:</strong>
- Centralized credential management
- Encryption at rest and in transit
- Audit logging
- Access policies and RBAC
- Automatic rotation support</p>
<p><strong>Disadvantages:</strong>
- Requires Azure subscription
- Additional setup complexity
- Network dependency</p>
<h3 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h3>
<h4 id="1-create-key-vault">1. Create Key Vault<a class="headerlink" href="#1-create-key-vault" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Variables</span>
<span class="nv">RESOURCE_GROUP</span><span class="o">=</span><span class="s2">&quot;retail-datagen-rg&quot;</span>
<span class="nv">LOCATION</span><span class="o">=</span><span class="s2">&quot;eastus&quot;</span>
<span class="nv">VAULT_NAME</span><span class="o">=</span><span class="s2">&quot;retail-datagen-kv&quot;</span>

<span class="c1"># Create resource group</span>
az<span class="w"> </span>group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span>--location<span class="w"> </span><span class="nv">$LOCATION</span>

<span class="c1"># Create Key Vault</span>
az<span class="w"> </span>keyvault<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span><span class="nv">$VAULT_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--location<span class="w"> </span><span class="nv">$LOCATION</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--enable-rbac-authorization<span class="w"> </span><span class="nb">false</span>
</code></pre></div>

<h4 id="2-store-connection-string">2. Store Connection String<a class="headerlink" href="#2-store-connection-string" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Store secret</span>
az<span class="w"> </span>keyvault<span class="w"> </span>secret<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--vault-name<span class="w"> </span><span class="nv">$VAULT_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span><span class="s2">&quot;eventhub-connection-string&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--value<span class="w"> </span><span class="s2">&quot;Endpoint=sb://your-namespace.servicebus.windows.net/;...&quot;</span>
</code></pre></div>

<h4 id="3-grant-access">3. Grant Access<a class="headerlink" href="#3-grant-access" title="Permanent link">&para;</a></h4>
<p><strong>Option A: Managed Identity (Recommended)</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Enable system-assigned managed identity for VM/App Service</span>
az<span class="w"> </span>vm<span class="w"> </span>identity<span class="w"> </span>assign<span class="w"> </span>--name<span class="w"> </span>myVM<span class="w"> </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span>

<span class="c1"># Grant Key Vault access</span>
<span class="nv">IDENTITY_ID</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>vm<span class="w"> </span>show<span class="w"> </span>--name<span class="w"> </span>myVM<span class="w"> </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span>--query<span class="w"> </span>identity.principalId<span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>

az<span class="w"> </span>keyvault<span class="w"> </span>set-policy<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span><span class="nv">$VAULT_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--object-id<span class="w"> </span><span class="nv">$IDENTITY_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--secret-permissions<span class="w"> </span>get<span class="w"> </span>list
</code></pre></div>

<p><strong>Option B: Service Principal</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Create service principal</span>
az<span class="w"> </span>ad<span class="w"> </span>sp<span class="w"> </span>create-for-rbac<span class="w"> </span>--name<span class="w"> </span>retail-datagen-sp

<span class="c1"># Grant Key Vault access</span>
<span class="nv">SP_OBJECT_ID</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>ad<span class="w"> </span>sp<span class="w"> </span>show<span class="w"> </span>--id<span class="w"> </span>&lt;app-id&gt;<span class="w"> </span>--query<span class="w"> </span>id<span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>

az<span class="w"> </span>keyvault<span class="w"> </span>set-policy<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span><span class="nv">$VAULT_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--object-id<span class="w"> </span><span class="nv">$SP_OBJECT_ID</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--secret-permissions<span class="w"> </span>get<span class="w"> </span>list
</code></pre></div>

<h3 id="application-integration">Application Integration<a class="headerlink" href="#application-integration" title="Permanent link">&para;</a></h3>
<h4 id="install-dependencies">Install Dependencies<a class="headerlink" href="#install-dependencies" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>azure-keyvault-secrets<span class="w"> </span>azure-identity
</code></pre></div>

<h4 id="python-code">Python Code<a class="headerlink" href="#python-code" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">azure.identity</span><span class="w"> </span><span class="kn">import</span> <span class="n">DefaultAzureCredential</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">azure.keyvault.secrets</span><span class="w"> </span><span class="kn">import</span> <span class="n">SecretClient</span>

<span class="c1"># Using Managed Identity (recommended)</span>
<span class="n">credential</span> <span class="o">=</span> <span class="n">DefaultAzureCredential</span><span class="p">()</span>
<span class="n">vault_url</span> <span class="o">=</span> <span class="s2">&quot;https://retail-datagen-kv.vault.azure.net/&quot;</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">SecretClient</span><span class="p">(</span><span class="n">vault_url</span><span class="o">=</span><span class="n">vault_url</span><span class="p">,</span> <span class="n">credential</span><span class="o">=</span><span class="n">credential</span><span class="p">)</span>

<span class="c1"># Retrieve secret</span>
<span class="n">connection_string</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_secret</span><span class="p">(</span><span class="s2">&quot;eventhub-connection-string&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</code></pre></div>

<h4 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h4>
<p>Update <code>config.json</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;realtime&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;use_keyvault&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;keyvault_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://retail-datagen-kv.vault.azure.net/&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;keyvault_secret_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eventhub-connection-string&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="best-practices-for-key-vault">Best Practices for Key Vault<a class="headerlink" href="#best-practices-for-key-vault" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Enable soft delete:</strong>
   <code>bash
   az keyvault update --name $VAULT_NAME --enable-soft-delete true</code></p>
</li>
<li>
<p><strong>Enable purge protection:</strong>
   <code>bash
   az keyvault update --name $VAULT_NAME --enable-purge-protection true</code></p>
</li>
<li>
<p><strong>Use RBAC instead of access policies:</strong>
   <code>bash
   az keyvault create --name $VAULT_NAME --enable-rbac-authorization true</code></p>
</li>
<li>
<p><strong>Monitor access:</strong>
   <code>bash
   az monitor diagnostic-settings create \
     --name KeyVaultAudit \
     --resource /subscriptions/{sub-id}/resourceGroups/{rg}/providers/Microsoft.KeyVault/vaults/{vault} \
     --logs '[{"category": "AuditEvent", "enabled": true}]' \
     --workspace /subscriptions/{sub-id}/resourcegroups/{rg}/providers/microsoft.operationalinsights/workspaces/{workspace}</code></p>
</li>
<li>
<p><strong>Implement caching:</strong>
   ```python
   # Cache secrets to reduce Key Vault calls
   from functools import lru_cache</p>
</li>
</ol>
<p>@lru_cache(maxsize=1)
   def get_connection_string():
       return client.get_secret("eventhub-connection-string").value
   ```</p>
<hr />
<h2 id="configuration-files">Configuration Files<a class="headerlink" href="#configuration-files" title="Permanent link">&para;</a></h2>
<h3 id="local-development-only">Local Development Only<a class="headerlink" href="#local-development-only" title="Permanent link">&para;</a></h3>
<p>Configuration files should only be used for local development and must never be committed.</p>
<h3 id="template-pattern">Template Pattern<a class="headerlink" href="#template-pattern" title="Permanent link">&para;</a></h3>
<p><strong>Commit a template:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c1">// config.template.json</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;realtime&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;azure_connection_string&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;YOUR_CONNECTION_STRING_HERE&gt;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;emit_interval_ms&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;burst&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Create local config from template:</strong></p>
<div class="codehilite"><pre><span></span><code>cp<span class="w"> </span>config.template.json<span class="w"> </span>config.json
<span class="c1"># Edit config.json with real credentials</span>
<span class="c1"># config.json is in .gitignore</span>
</code></pre></div>

<h3 id="encryption-at-rest">Encryption at Rest<a class="headerlink" href="#encryption-at-rest" title="Permanent link">&para;</a></h3>
<p>For additional security, encrypt configuration files:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Encrypt config file</span>
openssl<span class="w"> </span>enc<span class="w"> </span>-aes-256-cbc<span class="w"> </span>-salt<span class="w"> </span>-in<span class="w"> </span>config.json<span class="w"> </span>-out<span class="w"> </span>config.json.enc

<span class="c1"># Decrypt when needed</span>
openssl<span class="w"> </span>enc<span class="w"> </span>-aes-256-cbc<span class="w"> </span>-d<span class="w"> </span>-in<span class="w"> </span>config.json.enc<span class="w"> </span>-out<span class="w"> </span>config.json
</code></pre></div>

<p><strong>Store encryption key separately</strong> (environment variable or Key Vault).</p>
<h3 id="file-permissions">File Permissions<a class="headerlink" href="#file-permissions" title="Permanent link">&para;</a></h3>
<p>Restrict access to configuration files:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># Owner read/write only</span>
chmod<span class="w"> </span><span class="m">600</span><span class="w"> </span>config.json

<span class="c1"># Verify permissions</span>
ls<span class="w"> </span>-la<span class="w"> </span>config.json
<span class="c1"># -rw------- 1 user user 1234 Jan 15 10:00 config.json</span>
</code></pre></div>

<hr />
<h2 id="cicd-integration">CI/CD Integration<a class="headerlink" href="#cicd-integration" title="Permanent link">&para;</a></h2>
<h3 id="github-actions">GitHub Actions<a class="headerlink" href="#github-actions" title="Permanent link">&para;</a></h3>
<p><strong>Using GitHub Secrets:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deploy</span>
<span class="nt">on</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">push</span><span class="p p-Indicator">]</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v2</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.11&#39;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install -e .</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run tests with credentials</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">AZURE_EVENTHUB_CONNECTION_STRING</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.AZURE_EVENTHUB_CONNECTION_STRING }}</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pytest</span>
</code></pre></div>

<p><strong>Add secret to GitHub:</strong>
1. Repository  Settings  Secrets and variables  Actions
2. Click "New repository secret"
3. Name: <code>AZURE_EVENTHUB_CONNECTION_STRING</code>
4. Value: Your connection string
5. Click "Add secret"</p>
<h3 id="azure-devops">Azure DevOps<a class="headerlink" href="#azure-devops" title="Permanent link">&para;</a></h3>
<p><strong>Using Variable Groups:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">trigger</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>

<span class="nt">pool</span><span class="p">:</span>
<span class="w">  </span><span class="nt">vmImage</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;ubuntu-latest&#39;</span>

<span class="nt">variables</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">retail-datagen-secrets</span>

<span class="nt">steps</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">task</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UsePythonVersion@0</span>
<span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="w">    </span><span class="nt">versionSpec</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.11&#39;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">pip install -e .</span>
<span class="w">  </span><span class="nt">displayName</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Install</span><span class="nv"> </span><span class="s">dependencies&#39;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">script</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">pytest</span>
<span class="w">  </span><span class="nt">env</span><span class="p">:</span>
<span class="w">    </span><span class="nt">AZURE_EVENTHUB_CONNECTION_STRING</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$(AZURE_EVENTHUB_CONNECTION_STRING)</span>
<span class="w">  </span><span class="nt">displayName</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;Run</span><span class="nv"> </span><span class="s">tests&#39;</span>
</code></pre></div>

<p><strong>Create variable group:</strong>
1. Pipelines  Library  Variable groups
2. Click "Add variable group"
3. Name: <code>retail-datagen-secrets</code>
4. Add variable: <code>AZURE_EVENTHUB_CONNECTION_STRING</code>
5. Lock icon: Make secret
6. Save</p>
<h3 id="gitlab-cicd">GitLab CI/CD<a class="headerlink" href="#gitlab-cicd" title="Permanent link">&para;</a></h3>
<p><strong>Using CI/CD Variables:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nt">test</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:3.11</span>
<span class="w">  </span><span class="nt">before_script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pip install -e .</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pytest</span>
<span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">    </span><span class="nt">AZURE_EVENTHUB_CONNECTION_STRING</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$AZURE_EVENTHUB_CONNECTION_STRING</span>
</code></pre></div>

<p><strong>Add CI/CD variable:</strong>
1. Settings  CI/CD  Variables
2. Click "Add variable"
3. Key: <code>AZURE_EVENTHUB_CONNECTION_STRING</code>
4. Value: Your connection string
5. Flags: Protected, Masked
6. Save</p>
<hr />
<h2 id="rotation-revocation">Rotation &amp; Revocation<a class="headerlink" href="#rotation-revocation" title="Permanent link">&para;</a></h2>
<h3 id="regular-rotation">Regular Rotation<a class="headerlink" href="#regular-rotation" title="Permanent link">&para;</a></h3>
<p><strong>Recommended schedule:</strong>
- Development: Every 6 months
- Production: Every 3 months
- After personnel changes: Immediately</p>
<h3 id="rotation-process">Rotation Process<a class="headerlink" href="#rotation-process" title="Permanent link">&para;</a></h3>
<h4 id="1-generate-new-key">1. Generate New Key<a class="headerlink" href="#1-generate-new-key" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Regenerate primary key</span>
az<span class="w"> </span>eventhubs<span class="w"> </span>namespace<span class="w"> </span>authorization-rule<span class="w"> </span>keys<span class="w"> </span>renew<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace-name<span class="w"> </span><span class="nv">$NAMESPACE</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span>RootManageSharedAccessKey<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--key<span class="w"> </span>PrimaryKey

<span class="c1"># Get new connection string</span>
az<span class="w"> </span>eventhubs<span class="w"> </span>namespace<span class="w"> </span>authorization-rule<span class="w"> </span>keys<span class="w"> </span>list<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace-name<span class="w"> </span><span class="nv">$NAMESPACE</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span>RootManageSharedAccessKey<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--query<span class="w"> </span>primaryConnectionString<span class="w"> </span>-o<span class="w"> </span>tsv
</code></pre></div>

<h4 id="2-update-credentials">2. Update Credentials<a class="headerlink" href="#2-update-credentials" title="Permanent link">&para;</a></h4>
<p><strong>Environment variables:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_EVENTHUB_CONNECTION_STRING</span><span class="o">=</span><span class="s2">&quot;&lt;new-connection-string&gt;&quot;</span>
</code></pre></div>

<p><strong>Key Vault:</strong></p>
<div class="codehilite"><pre><span></span><code>az<span class="w"> </span>keyvault<span class="w"> </span>secret<span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--vault-name<span class="w"> </span><span class="nv">$VAULT_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span><span class="s2">&quot;eventhub-connection-string&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--value<span class="w"> </span><span class="s2">&quot;&lt;new-connection-string&gt;&quot;</span>
</code></pre></div>

<h4 id="3-restart-applications">3. Restart Applications<a class="headerlink" href="#3-restart-applications" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Docker</span>
docker<span class="w"> </span>restart<span class="w"> </span>retail-datagen

<span class="c1"># Kubernetes</span>
kubectl<span class="w"> </span>rollout<span class="w"> </span>restart<span class="w"> </span>deployment/retail-datagen

<span class="c1"># Systemd</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>retail-datagen
</code></pre></div>

<h4 id="4-verify">4. Verify<a class="headerlink" href="#4-verify" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:8000/api/stream/test
</code></pre></div>

<h3 id="emergency-revocation">Emergency Revocation<a class="headerlink" href="#emergency-revocation" title="Permanent link">&para;</a></h3>
<p>If credentials are compromised:</p>
<ol>
<li>
<p><strong>Immediately regenerate both keys:</strong>
   <code>bash
   az eventhubs namespace authorization-rule keys renew \
     --key PrimaryKey
   az eventhubs namespace authorization-rule keys renew \
     --key SecondaryKey</code></p>
</li>
<li>
<p><strong>Review audit logs:</strong>
   <code>bash
   az monitor activity-log list \
     --resource-group $RESOURCE_GROUP \
     --start-time $(date -u -d '1 hour ago' '+%Y-%m-%dT%H:%M:%SZ')</code></p>
</li>
<li>
<p><strong>Notify security team</strong></p>
</li>
<li>
<p><strong>Update all applications</strong></p>
</li>
<li>
<p><strong>Document incident</strong></p>
</li>
</ol>
<hr />
<h2 id="audit-compliance">Audit &amp; Compliance<a class="headerlink" href="#audit-compliance" title="Permanent link">&para;</a></h2>
<h3 id="enable-audit-logging">Enable Audit Logging<a class="headerlink" href="#enable-audit-logging" title="Permanent link">&para;</a></h3>
<p><strong>Azure Event Hub diagnostic settings:</strong></p>
<div class="codehilite"><pre><span></span><code>az<span class="w"> </span>monitor<span class="w"> </span>diagnostic-settings<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span>EventHubAudit<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--resource<span class="w"> </span>/subscriptions/<span class="o">{</span>sub-id<span class="o">}</span>/resourceGroups/<span class="o">{</span>rg<span class="o">}</span>/providers/Microsoft.EventHub/namespaces/<span class="o">{</span>namespace<span class="o">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--logs<span class="w"> </span><span class="s1">&#39;[</span>
<span class="s1">    {&quot;category&quot;: &quot;ArchiveLogs&quot;, &quot;enabled&quot;: true},</span>
<span class="s1">    {&quot;category&quot;: &quot;OperationalLogs&quot;, &quot;enabled&quot;: true}</span>
<span class="s1">  ]&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--workspace<span class="w"> </span>/subscriptions/<span class="o">{</span>sub-id<span class="o">}</span>/resourcegroups/<span class="o">{</span>rg<span class="o">}</span>/providers/microsoft.operationalinsights/workspaces/<span class="o">{</span>workspace<span class="o">}</span>
</code></pre></div>

<p><strong>Key Vault audit logging:</strong></p>
<div class="codehilite"><pre><span></span><code>az<span class="w"> </span>monitor<span class="w"> </span>diagnostic-settings<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span>KeyVaultAudit<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--resource<span class="w"> </span>/subscriptions/<span class="o">{</span>sub-id<span class="o">}</span>/resourceGroups/<span class="o">{</span>rg<span class="o">}</span>/providers/Microsoft.KeyVault/vaults/<span class="o">{</span>vault<span class="o">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--logs<span class="w"> </span><span class="s1">&#39;[{&quot;category&quot;: &quot;AuditEvent&quot;, &quot;enabled&quot;: true}]&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--workspace<span class="w"> </span>/subscriptions/<span class="o">{</span>sub-id<span class="o">}</span>/resourcegroups/<span class="o">{</span>rg<span class="o">}</span>/providers/microsoft.operationalinsights/workspaces/<span class="o">{</span>workspace<span class="o">}</span>
</code></pre></div>

<h3 id="query-audit-logs">Query Audit Logs<a class="headerlink" href="#query-audit-logs" title="Permanent link">&para;</a></h3>
<p><strong>Azure Monitor Logs (KQL):</strong></p>
<div class="codehilite"><pre><span></span><code><span class="c">// Key Vault access logs</span>
<span class="n">AzureDiagnostics</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">ResourceType</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;VAULTS&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">OperationName</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;SecretGet&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">ResultSignature</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;OK&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="p">,</span><span class="w"> </span><span class="n">CallerIPAddress</span><span class="p">,</span><span class="w"> </span><span class="n">Resource</span><span class="p">,</span><span class="w"> </span><span class="n">OperationName</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="w"> </span><span class="n">desc</span>

<span class="c">// Event Hub operations</span>
<span class="n">AzureDiagnostics</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">ResourceType</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;EVENTHUBS&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">Category</span><span class="w"> </span><span class="p">==</span><span class="w"> </span><span class="s">&quot;OperationalLogs&quot;</span>
<span class="p">|</span><span class="w"> </span><span class="k">project</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="p">,</span><span class="w"> </span><span class="n">OperationName</span><span class="p">,</span><span class="w"> </span><span class="n">ResultDescription</span>
<span class="p">|</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">TimeGenerated</span><span class="w"> </span><span class="n">desc</span>
</code></pre></div>

<h3 id="compliance-reports">Compliance Reports<a class="headerlink" href="#compliance-reports" title="Permanent link">&para;</a></h3>
<p><strong>Generate credential usage report:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Credential Audit Report ===&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Generated: </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Key Vault Secrets ===&quot;</span>
az<span class="w"> </span>keyvault<span class="w"> </span>secret<span class="w"> </span>list<span class="w"> </span>--vault-name<span class="w"> </span><span class="nv">$VAULT_NAME</span><span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;[].{Name:name, Created:attributes.created, Updated:attributes.updated}&quot;</span><span class="w"> </span>-o<span class="w"> </span>table

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Event Hub Access Policies ===&quot;</span>
az<span class="w"> </span>eventhubs<span class="w"> </span>namespace<span class="w"> </span>authorization-rule<span class="w"> </span>list<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace-name<span class="w"> </span><span class="nv">$NAMESPACE</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--query<span class="w"> </span><span class="s2">&quot;[].{Name:name, Rights:rights}&quot;</span><span class="w"> </span>-o<span class="w"> </span>table

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Recent Key Vault Access ===&quot;</span>
az<span class="w"> </span>monitor<span class="w"> </span>activity-log<span class="w"> </span>list<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RESOURCE_GROUP</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--start-time<span class="w"> </span><span class="k">$(</span>date<span class="w"> </span>-u<span class="w"> </span>-d<span class="w"> </span><span class="s1">&#39;7 days ago&#39;</span><span class="w"> </span><span class="s1">&#39;+%Y-%m-%dT%H:%M:%SZ&#39;</span><span class="k">)</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--query<span class="w"> </span><span class="s2">&quot;[?contains(resourceId, &#39;vaults&#39;)].{Time:eventTimestamp, Operation:operationName.value, Status:status.value}&quot;</span><span class="w"> </span>-o<span class="w"> </span>table
</code></pre></div>

<h3 id="compliance-checklist">Compliance Checklist<a class="headerlink" href="#compliance-checklist" title="Permanent link">&para;</a></h3>
<ul>
<li>[ ] Credentials not in version control</li>
<li>[ ] Environment variables or Key Vault used</li>
<li>[ ] Least privilege access policies configured</li>
<li>[ ] Audit logging enabled</li>
<li>[ ] Rotation schedule defined</li>
<li>[ ] Emergency revocation procedure documented</li>
<li>[ ] Access reviewed quarterly</li>
<li>[ ] Compliance requirements met (SOC 2, ISO 27001, etc.)</li>
</ul>
<hr />
<h2 id="security-incident-response">Security Incident Response<a class="headerlink" href="#security-incident-response" title="Permanent link">&para;</a></h2>
<h3 id="if-credentials-are-leaked">If Credentials Are Leaked<a class="headerlink" href="#if-credentials-are-leaked" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Immediately revoke compromised credentials</strong></li>
<li><strong>Generate new credentials</strong></li>
<li><strong>Update all applications</strong></li>
<li><strong>Review logs for unauthorized access</strong></li>
<li><strong>Notify security team and stakeholders</strong></li>
<li><strong>Document incident and lessons learned</strong></li>
<li><strong>Implement additional controls</strong></li>
</ol>
<h3 id="prevention-checklist">Prevention Checklist<a class="headerlink" href="#prevention-checklist" title="Permanent link">&para;</a></h3>
<ul>
<li>[ ] Pre-commit hooks prevent credential commits</li>
<li>[ ] <code>.gitignore</code> configured correctly</li>
<li>[ ] Secrets scanning enabled (GitHub, GitLab, etc.)</li>
<li>[ ] Regular security training for team</li>
<li>[ ] Incident response plan documented</li>
<li>[ ] Regular credential rotation schedule</li>
</ul>
<hr />
<h2 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.microsoft.com/en-us/azure/key-vault/">Azure Key Vault Documentation</a></li>
<li><a href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-security-controls">Azure Event Hubs Security</a></li>
<li><a href="https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html">OWASP Secrets Management Cheat Sheet</a></li>
<li><a href="https://csrc.nist.gov/publications/detail/sp/800-57-part-1/rev-5/final">NIST SP 800-57: Key Management</a></li>
</ul>
<hr />
<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Setup</strong>: See <a href="../STREAMING_SETUP/">STREAMING_SETUP.md</a> for initial configuration</li>
<li><strong>Operations</strong>: See <a href="../STREAMING_OPERATIONS/">STREAMING_OPERATIONS.md</a> for monitoring</li>
<li><strong>API Reference</strong>: See <a href="../STREAMING_API/">STREAMING_API.md</a> for endpoint documentation</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.sections", "navigation.top", "content.code.copy", "toc.integrate"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>